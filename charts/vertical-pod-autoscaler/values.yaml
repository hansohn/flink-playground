# Shared image configuration
image:
  repository: registry.k8s.io/autoscaling/vpa
  pullPolicy: IfNotPresent

# Recommender (monitors pods and generates recommendations)
recommender:
  enabled: true
  replicaCount: 1
  tag: "1.0.0"

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

  # Prometheus integration (optional, enhances recommendations with historical data)
  prometheus:
    enabled: false
    address: "http://prometheus.monitoring.svc:9090"
    # When enabled, VPA uses Prometheus for historical metrics instead of in-memory cache
    # Provides better recommendations based on long-term patterns (weeks/months vs. 8 days)

  # Args tuned for Kind / local dev
  args:
    - --recommendation-margin-fraction=0.15
    - --pod-recommendation-min-cpu-millicores=25
    - --pod-recommendation-min-memory-mb=100
    - --v=4

  nodeSelector: {}
  tolerations: []
  affinity: {}

# Updater (evicts pods to apply recommendations)
# NOTE: Disable when using HPA to avoid conflicts. VPA updater can interfere with HPA scaling.
# Enable only if: (a) not using HPA, or (b) VPA manages memory while HPA manages CPU
updater:
  enabled: false
  replicaCount: 1
  tag: "1.0.0"

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

  args:
    - --eviction-tolerance=0.5
    - --eviction-rate-limit=1
    - --v=4

  nodeSelector: {}
  tolerations: []
  affinity: {}

# Admission Controller (webhook for initial recommendations)
admissionController:
  enabled: true
  replicaCount: 1
  tag: "1.0.0"

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

  args:
    - --v=4

  service:
    port: 443
    targetPort: 8000

  # Webhook TLS settings - Kind uses insecure for dev
  webhook:
    insecureSkipTLSVerify: true

  nodeSelector: {}
  tolerations: []
  affinity: {}
